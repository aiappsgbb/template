# azure.yaml defines the Azure Developer CLI (azd) project configuration
name: azd-template
metadata:
  template: azd-template@0.0.1-beta

# Infrastructure configuration
infra:
  provider: bicep
  path: infra
  module: main
  parameters: main.parameters.json

# Platform configuration for Azure Container Apps
platform:
  type: devcenter

services:
  
  # Additional service examples with remote builds:
  # web:
  #   project: "./src/web"
  #   language: js
  #   host: containerapp
  #   docker:
  #     remoteBuild: true
  # api:
  #   project: "./src/api"  
  #   language: python
  #   host: containerapp
  #   docker:
  #     remoteBuild: true

# Hooks allow you to run scripts at various points in the azd workflow
# Using Python with uv for better dependency management
hooks:
  # Runs before provisioning
  preprovision:
    shell: pwsh
    run: |
      cd infra/scripts
      uv run python preprovision.py
  
  # Runs after provisioning - useful for importing container images or setting up resources
  postprovision:
    shell: pwsh
    run: |
      cd infra/scripts
      uv run python postprovision.py
  
  # Runs before deployment
  predeploy:
    shell: pwsh
    run: |
      cd infra/scripts
      uv run python predeploy.py
  
  # Runs after deployment - useful for final configuration or notifications
  postdeploy:
    shell: pwsh
    run: |
      cd infra/scripts
      uv run python postdeploy.py